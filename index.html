<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Hangman Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { margin:0; height:100vh; background:#0a0a1a; color:#0ff; font-family:system-ui,sans-serif;
         display:flex; justify-content:center; align-items:center; overflow:hidden; }
  .game { width:95%; max-width:460px; padding:1.5px 20px 30px; background:rgba(15,15,40,0.95);
          border-radius:25px; box-shadow:0 0 60px #0ff; text-align:center; }
  h1 { margin:10px 0 20px; font-size:2.8rem; text-shadow:0 0 20px #0ff; }
  input#code { padding:14px; font-size:1.8rem; width:200px; text-align:center; background:#000;
               border:3px solid #0ff; color:#0ff; border-radius:15px; box-shadow:0 0 25px #0ff;
               text-transform:uppercase; margin:15px 0; }
  .btn { background:#0ff; color:#000; padding:14px 30px; margin:10px; font-size:1.5rem;
          border:none; border-radius:15px; cursor:pointer; font-weight:bold; box-shadow:0 0 30px #0ff; }
  .btn:hover { transform:scale(1.08); }
  .hangman { width:170px; height:210px; margin:20px auto; }
  .word { font-size:3.4rem; letter-spacing:0.9rem; margin:20px 0; font-weight:bold; }
  .letter { display:inline-block; min-width:50px; }
  #message { font-size:1.7rem; min-height:50px; margin:15px 0; }
  .keyboard { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:25px 0; }
  .key { width:48px; height:48px; background:none; border:3px solid #0ff; color:#0ff;
          border-radius:14px; font-size:1.7rem; cursor:pointer; box-shadow:0 0 18px #0ff; font-weight:bold; }
  .key:hover:not(:disabled) { background:#0ff; color:#000; }
  .key:disabled { opacity:0.3; }
  #chatBox { height:140px; overflow-y:auto; background:#000; border:2px solid #0ff;
             border-radius:12px; padding:12px; margin:20px 0; text-align:left; font-size:1rem;
             scrollbar-width:thin; scrollbar-color:#0ff #000; }
  #chatInput { width:68%; padding:12px; background:#000; border:2px solid #0ff; color:#0ff;
                border-radius:12px; font-size:1rem; }
  .part { display:none; }
  #menu, #gameArea { width:100%; }
  #gameArea { display:none; }
</style>
</head>
<body>

<div class="game">
  <h1>Neon Hangman</h1>

  <div id="menu">
    <input type="text" id="code" placeholder="GAME CODE" maxlength="6">
    <br>
    <button class="btn" onclick="createGame()">Create Game</button>
    <button class="btn" onclick="joinGame()">Join Game</button>
  </div>

  <div id="gameArea">
    <div class="hangman">
      <svg viewBox="0 0 200 250">
        <line x1="20" y1="230" x2="180" y2="230" stroke="#0ff" stroke-width="8"/>
        <line x1="50" y1="230" x2="50" y2="20" stroke="#0ff" stroke-width="8"/>
        <line x1="50" y1="20" x2="140" y2="20" stroke="#0ff" stroke-width="8"/>
        <line x1="140" y1="20" x2="140" y2="50" stroke="#0ff" stroke-width="8"/>
        <circle cx="140" cy="70" r="20" stroke="#0ff" stroke-width="6" fill="none" class="part"/>
        <line x1="140" y1="90" x2="140" y2="160" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="110" x2="110" y2="140" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="110" x2="170" y2="140" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="160" x2="120" y2="200" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="160" x2="160" y2="200" stroke="#0ff" stroke-width="6" class="part"/>
      </svg>
    </div>

    <div class="word" id="word"></div>
    <div id="message"></div>

    <div class="keyboard" id="keyboard"></div>

    <div id="chatBox"></div>
    <input type="text" id="chatInput" placeholder="Chat..." maxlength="120"
           onkeypress="if(event.key==='Enter')sendMessage()">
    <button class="btn" onclick="sendMessage()">Send</button>

    <br><br>
    <button class="btn" onclick="location.reload()">New Game</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEYmvhNMeI5GtkjBagq0XDhaa049yqKYU",
  authDomain: "hangman-b5477.firebaseapp.com",
  projectId: "hangman-b5477",
  storageBucket: "hangman-b5477.firebasestorage.app",
  messagingSenderId: "659695148674",
  appId: "1:659695148674:web:a538354378ed8dddec5e9b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let gameCode = "";
let isHost = false;

function createGame() {
  gameCode = Math.random().toString(36).substring(2,8).toUpperCase();
  document.getElementById("code").value = gameCode;
  isHost = true;
  alert("Share this code with your friend:\n\n" + gameCode);
  startGame();
}

function joinGame() {
  gameCode = document.getElementById("code").value.trim().toUpperCase();
  if (gameCode.length !== 6) return alert("Enter 6-letter code!");
  isHost = false;
  startGame();
}

function startGame() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("gameArea").style.display = "block";

  const gameRef = db.collection("games").doc(gameCode);

  if (isHost) {
    gameRef.set({ status: "waiting", messages: [] });
    addChat("Waiting for friend to join and set word...");
  } else {
    // Guest sets the word immediately
    const word = prompt("Enter secret word (3-12 letters only):")?.trim().toUpperCase();
    if (!/^[A-Z]{3,12}$/.test(word)) {
      alert("Invalid word!");
      location.reload();
      return;
    }
    gameRef.set({
      word: word,
      guessed: Array(word.length).fill(false),
      wrongs: 0,
      status: "playing",
      messages: [{text: "Word set! Start guessing!", time: Date.now()}]
    });
    addChat("Word set! Your friend can start guessing");
  }

  // Listen to game state
  gameRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    if (data.word) updateGame(data);
    if (data.messages) updateChat(data.messages);
  });
}

function updateGame(data) {
  // Word
  const w = document.getElementById("word");
  w.innerHTML = "";
  for (let i=0; i<data.word.length; i++) {
    const s = document.createElement("span");
    s.className = "letter";
    s.textContent = data.guessed[i] ? data.word[i] : "_";
    w.appendChild(s);
  }

  // Hangman drawing
  document.querySelectorAll(".part").forEach((p,i) => {
    p.style.display = i < data.wrongs ? "block" : "none";
  });

  // Keyboard
  const kb = document.getElementById("keyboard");
  kb.innerHTML = "";
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => {
    const btn = document.createElement("button");
    btn.className = "key";
    btn.textContent = l;
    btn.onclick = () => guess(l);
    if (data.guessed.some((g,j) => g && data.word[j]===l) || data.wrongs >= 6) btn.disabled = true;
    kb.appendChild(btn);
  });

  // Win/lose message
  if (data.guessed.every(Boolean)) {
    document.getElementById("message").innerHTML = "WINNER!";
  } else if (data.wrongs >= 6) {
    document.getElementById("message").innerHTML = `Game Over!<br>Word was: <span style="color:#0f0">${data.word}</span>`;
  }
}

function guess(letter) {
  if (!isHost) return; // only host guesses
  const gameRef = db.collection("games").doc(gameCode);
  gameRef.get().then(doc => {
    const d = doc.data();
    let newGuessed = d.guessed.slice();
    let newWrongs = d.wrongs;
    let found = false;
    for (let i=0; i<d.word.length; i++) {
      if (d.word[i] === letter) { newGuessed[i] = true; found = true; }
    }
    if (!found) newWrongs++;
    gameRef.update({ guessed: newGuessed, wrongs: newWrongs });
  });
}

function sendMessage() {
  const input = document.getElementById("chatInput");
  const text = input.value.trim();
  if (!text) return;
  db.collection("games").doc(gameCode).update({
    messages: firebase.firestore.FieldValue.arrayUnion({
      text: text,
      sender: isHost ? "Host" : "Guest",
      time: Date.now()
    })
  });
  input.value = "";
}

function updateChat(messages) {
  const box = document.getElementById("chatBox");
  box.innerHTML = "";
  messages.forEach(m => {
    const div = document.createElement("div");
    div.textContent = m.text;
    div.style.margin = "6px 0";
    box.appendChild(div);
  });
  box.scrollTop = box.scrollHeight;
}

function addChat(text) {
  const box = document.getElementById("chatBox");
  const div = document.createElement("div");
  div.textContent = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
}
</script>
</body>
</html>
