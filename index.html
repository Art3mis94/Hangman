<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neon Hangman Online</title>
<style>
  body { margin:0; height:100vh; background:#0f0f1e; color:#0ff; font-family:'Segoe UI,sans-serif;
         display:flex; justify-content:center; align-items:center; overflow:hidden; }
  .game { width:90%; max-width:520px; padding:2rem; background:rgba(20,20,40,0.95);
          border-radius:20px; box-shadow:0 0 0 60px #0ff; text-align:center; }
  h1 { margin:0 0 1rem; font-size:3rem; text-shadow:0 0 25px #0ff; }
  input, button { font-family:inherit; }
  #code { padding:1rem 2rem; font-size:1.8rem; width:220px; text-align:center; background:#000;
          border:3px solid #0ff; color:#0ff; border-radius:15px; box-shadow:0 0 30px #0ff;
          text-transform:uppercase; margin:1rem 0; }
  .btn { background:#0ff; color:#000; padding:1rem 2.5rem; margin:0.8rem; font-size:1.6rem;
          border:none; border-radius:15px; cursor:pointer; box-shadow:0 0 30px #0ff; font-weight:bold; }
  .btn:hover { transform:scale(1.07); }
  .hangman { width:180px; height:220px; margin:2rem auto; }
  .word { font-size:3.5rem; letter-spacing:0.9rem; margin:1.5rem 0; font-weight:bold; }
  .letter { display:inline-block; min-width:55px; }
  #message { font-size:1.8rem; min-height:2.5rem; margin:1rem 0; }
  .keyboard { display:flex; flex-wrap:wrap; justify-content:center; gap:11px; margin:2rem 0; }
  .key { width:52px; height:52px; background:none; border:3px solid #0ff; color:#0ff;
          border-radius:15px; font-size:1.8rem; cursor:pointer; box-shadow:0 0 20px #0ff; }
  .key:hover:not(:disabled) { background:#0ff; color:#000; }
  .key:disabled { opacity:0.4; }
  .part { display:none; }
  #chat { height:180px; overflow-y:auto; background:#000; border:2px solid #0ff;
           border-radius:12px; padding:1rem; margin:1.5rem 0; text-align:left; font-size:1.1rem; }
  #chatMsg { width:70%; padding:0.8rem; background:#000; border:2px solid #0ff; color:#0ff;
              border-radius:12px; }
  #menu, #gameArea { width:100%; }
  #gameArea { display:none; }
</style>
</head>
<body>

<div class="game">
  <h1>Neon Hangman Online</h1>

  <div id="menu">
    <input type="text" id="code" placeholder="GAME CODE" maxlength="6">
    <br>
    <button class="btn" onclick="createGame()">Create Game</button>
    <button class="btn" onclick="joinGame()">Join Game</button>
  </div>

  <div id="gameArea">
    <div class="hangman">
      <svg viewBox="0 0 200 250">
        <line x1="20" y1="230" x2="180" y2="230" stroke="#0ff" stroke-width="8"/>
        <line x1="50" y1="230" x2="50" y2="20" stroke="#0ff" stroke-width="8"/>
        <line x1="50" y1="20" x2="140" y2="20" stroke="#0ff" stroke-width="8"/>
        <line x1="140" y1="20" x2="140" y2="50" stroke="#0ff" stroke-width="8"/>
        <circle cx="140" cy="70" r="20" stroke="#0ff" stroke-width="6" fill="none" class="part"/>
        <line x1="140" y1="90" x2="140" y2="160" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="110" x2="110" y2="140" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="110" x2="170" y2="140" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="160" x2="120" y2="200" stroke="#0ff" stroke-width="6" class="part"/>
        <line x1="140" y1="160" x2="160" y2="200" stroke="#0ff" stroke-width="6" class="part"/>
      </svg>
    </div>

    <div class="word" id="word"></div>
    <div id="message"></div>

    <div class="keyboard" id="keyboard"></div>

    <div id="chat"></div>
    <input type="text" id="chatMsg" placeholder="Type a message..." maxlength="100"
           onkeypress="if(event.key==='Enter')sendChat()">
    <button class="btn" style="width:80px" onclick="sendChat()">Send</button>

    <br><br>
    <button class="btn" onclick="location.reload()">New Game</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEYmvhNMeI5GtkjBagq0XDhaa049yqKYU",
  authDomain: "hangman-b5477.firebaseapp.com",
  projectId: "hangman-b5477",
  storageBucket: "hangman-b5477.firebasestorage.app",
  messagingSenderId: "659695148674",
  appId: "1:659695148674:web:a538354378ed8dddec5e9b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let gameCode = "";
let role = ""; // "host" = guesser, "guest" = word setter

function createGame() {
  gameCode = Math.random().toString(36).substr(2,6).toUpperCase();
  document.getElementById("code").value = gameCode;
  alert("Share this code:\n" + gameCode);
  role = "host";
  startGame();
}

function joinGame() {
  gameCode = document.getElementById("code").value.trim().toUpperCase();
  if (!gameCode) return alert("Enter code!");
  role = "guest";
  startGame();
}

function startGame() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("gameArea").style.display = "block";

  const gameRef = db.collection("games").doc(gameCode);

  // Guest immediately sets the word
  if (role === "guest") {
    const w = prompt("Enter the secret word (3â€“12 letters):")?.trim().toUpperCase();
    if (/^[A-Z]{3,12}$/.test(w)) {
      gameRef.set({
        word: w,
        guessed: Array(w.length).fill(false),
        wrongs: 0,
        messages: [{text: "Game started! Word is set.", time: Date.now()}]
      });
      addChat("Word set! Your friend can start guessing.");
    } else {
      alert("Invalid word!");
      location.reload();
    }
  } else {
    // Host just waits
    gameRef.set({ messages: [] }, { merge: true });
    addChat("Waiting for friend to set the word...");
  }

  // Listen to everything
  gameRef.onSnapshot(doc => {
    if (!doc.exists) return;
    const d = doc.data();
    if (d.word) renderGame(d);
    if (d.messages) renderChat(d.messages);
  });
}

function renderGame(data) {
  // Word
  const wordDiv = document.getElementById("word");
  wordDiv.innerHTML = "";
  for (let i = 0; i < data.word.length; i++) {
    const s = document.createElement("span");
    s.className = "letter";
    s.textContent = data.guessed[i] ? data.word[i] : "_";
    wordDiv.appendChild(s);
  }

  // Hangman
  document.querySelectorAll(".part").forEach((p,i) => {
    p.style.display = i < data.wrongs ? "block" : "none";
  });

  // Keyboard
  const kb = document.getElementById("keyboard");
  kb.innerHTML = "";
  "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(l => {
    const btn = document.createElement("button");
    btn.className = "key";
    btn.textContent = l;
    btn.onclick = () => guess(l);
    if (data.guessed.some((g,j) => g && data.word[j]===l) || data.wrongs >= 6) btn.disabled = true;
    kb.appendChild(btn);
  });

  // Win/lose
  if (data.guessed.every(Boolean)) {
    document.getElementById("message").innerHTML = "YOU WIN!";
  } else if (data.wrongs >= 6) {
    document.getElementById("message").innerHTML = `Game Over! Word was: <span style="color:#0f0">${data.word}</span>`;
  }
}

function guess(letter) {
  if (role !== "host") return;
  db.collection("games").doc(gameCode).get().then(doc => {
    const d = doc.data();
    let guessed = d.guessed.slice();
    let wrongs = d.wrongs;
    let found = false;
    for (let i = 0; i < d.word.length; i++) {
      if (d.word[i] === letter) { guessed[i] = true; found = true; }
    }
    if (!found) wrongs++;
    db.collection("games").doc(gameCode).update({ guessed, wrongs });
  });
}

function sendChat() {
  const input = document.getElementById("chatMsg");
  const text = input.value.trim();
  if (!text) return;
  db.collection("games").doc(gameCode).update({
    messages: firebase.firestore.FieldValue.arrayUnion({
      text: text,
      time: Date.now(),
      sender: role === "host" ? "You" : role
    })
  });
  input.value = "";
}

function addChat(text) {
  const div = document.createElement("div");
  div.textContent = text;
  document.getElementById("chat").appendChild(div);
  div.scrollIntoView();
}

function renderChat(messages) {
  const chat = document.getElementById("chat");
  chat.innerHTML = "";
  messages.forEach(m => {
    const div = document.createElement("div");
    div.textContent = m.text;
    div.style.margin = "4px 0";
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
}
</script>
</body>
</html>
